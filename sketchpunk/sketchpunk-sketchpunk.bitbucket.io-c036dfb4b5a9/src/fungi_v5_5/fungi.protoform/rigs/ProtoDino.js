import App		from "../../fungi/App.js";
import EyeBall	from "./EyeBall.js";

const DINO_BONES = [
	{"name":"hips","len":0.2409,"idx":0,"p_idx":null, "pos":[0,1.5999,0.0513],"rot":[3.038739464500395e-7,0.7205613851547241,0.6933911442756653,-2.550459612393752e-7]},
	{"name":"spine1","len":0.4254,"idx":1,"p_idx":0,"pos":[0,0.2409,0],"rot":[0.018432877957820892,1.2677458194332303e-8,-2.2406341315672762e-7,0.9998301267623901]},
	{"name":"spine2","len":0.5004,"idx":2,"p_idx":1, "pos":[0,0.4254,0],"rot":[0.08151549100875854,9.942978067556396e-7,-0.0000021349173948692624,0.9966720938682556]},
	{"name":"neck","len":0.4574,"idx":3,"p_idx":2,"pos":[0,0.5004,0],"rot":[-0.027167245745658875,-9.858557632469456e-7,6.493367550319817e-7,0.9996309280395508]},
	{"name":"head","len":0.55,"idx":4,"p_idx":3, "pos":[0,0.4574785828590393,0],"rot":[-0.08995335549116135,-2.650070314302866e-7,0.0000013838683798894635,0.9959459900856018]},
	
	{"name":"shoulder.L","len":0.1782,"idx":5,"p_idx":1, "pos":[-0.0632,0.8049,0],"rot":[-0.1343054622411728,-0.08170288801193237,0.7023701667785645,0.6942353844642639]},
	{"name":"arm_up.L","len":0.2147,"idx":6,"p_idx":5, "pos":[0,0.1782,0],"rot":[-0.5978032350540161,0.6839662790298462,-0.17942018806934357,0.37766361236572266]},
	{"name":"arm_fore.L","len":0.2443,"idx":7,"p_idx":6, "pos":[0,0.2147,0],"rot":[0.7058572173118591,0.00009812167991185561,-0.0002388480061199516,0.708354115486145]},
	{"name":"hand.L","len":0.1295,"idx":8,"p_idx":7, "pos":[0,0.2443,0],"rot":[0.36829447746276855,0.00018096140411216766,0.0001879366609500721,0.9297091364860535]},
	
	{"name":"finger_a0.L","len":0.0883,"idx":9,"p_idx":8, "pos":[0.0492,0.1234,-0.0003],"rot":[-0.3087947368621826,5.556726137001533e-7,-1.3609601978714636e-7,0.9511287212371826]},
	{"name":"finger_a1.L","len":0.1,"idx":10,"p_idx":9, "pos":[0,0.0883,0],"rot":[-0.3188095986843109,-0.0000013524665973818628,1.3770137741175859e-7,0.9478187561035156]},
	{"name":"finger_b0.L","len":0.0802,"idx":11,"p_idx":8, "pos":[-0.0501,0.1230,-0.0006],"rot":[-0.29034093022346497,-9.611323292801899e-9,5.145425774344403e-8,0.956923246383667]},
	{"name":"finger_b1.L","len":0.1,"idx":12,"p_idx":11, "pos":[0,0.0802,0],"rot":[-0.31688806414604187,-4.4743097760147066e-7,2.0646025689075032e-7,0.948462963104248]},
	
	{"name":"shoulder.R","len":0.1782,"idx":13,"p_idx":1,"pos":[0.0632,0.8349,0],"rot":[-0.1343054175376892,0.08170289546251297,-0.7023704051971436,0.6942351460456848]},
	{"name":"arm_up.R","len":0.2147,"idx":14,"p_idx":13,"pos":[0,0.1782,0],"rot":[0.5978031754493713,0.683966338634491,-0.17942030727863312,-0.3776634931564331]},
	{"name":"arm_fore.R","len":0.2443,"idx":15,"p_idx":14,"pos":[0,0.2147,0],"rot":[0.7058571577072144,-0.00009801638225326315,0.00023875318584032357,0.7083541750907898]},
	{"name":"hand.R","len":0.1295,"idx":16,"p_idx":15,"pos":[0,0.2443,0],"rot":[0.36829447746276855,-0.0001809593813959509,-0.00018794155039358884,0.9297091364860535]},
	
	{"name":"finger_a0.R","len":0.0883,"idx":17,"p_idx":16,"pos":[-0.0492,0.1234,-0.0003],"rot":[-0.30879467725753784,-5.556881887969212e-7,1.361010077971514e-7,0.9511287212371826]},
	{"name":"finger_a1.R","len":0.1,"idx":18,"p_idx":17, "pos":[0,0.0883,0],"rot":[-0.3188095986843109,0.0000013541666703531519,-1.3265248810512276e-7,0.9478187561035156]},
	{"name":"finger_b0.R","len":0.0802,"idx":19,"p_idx":16,"pos":[0.0501,0.1230,-0.0006],"rot":[-0.2903409004211426,9.5958592183365e-9,-5.1449564608674336e-8,0.9569233059883118]},
	{"name":"finger_b1.R","len":0.1,"idx":20,"p_idx":19,"pos":[0,0.0802,0],"rot":[-0.31688815355300903,4.4909725716024695e-7,-2.0147720647401002e-7,0.9484629034996033]},
	
	{"name":"leg_0.L","len":0.6824,"idx":21,"p_idx":0, "pos":[-0.3682,-0.0019,0],"rot":[-0.7205613851547241, 7.525101608507612e-8, -1.7464532930944188e-8, 0.6933911442756653]},
	{"name":"leg_1.L","len":0.5962,"idx":22,"p_idx":21,"pos":[0,0.6824,0],"rot":[1.389984115762917e-14, 1.7941249552677618e-7, -3.0515219545695265e-15, 1]},
	{"name":"leg_2.L","len":0.4033,"idx":23,"p_idx":22,"pos":[0,0.5962,0],"rot":[3.8837472716169698e-22, -5.373496492211416e-7, 2.837178004216992e-23, 1]},
	
	{"name":"foot.L","len":0.1590,"idx":24,"p_idx":23, "pos":[0,0.4033,0],"rot":[0.6393926739692688,3.628278477663116e-7,-2.5215112486876023e-7,0.7688803672790527]},
	{"name":"toe_a0.L","len":0.0928,"idx":25,"p_idx":24,"pos":[-0.0717,0.1534,0],"rot":[-2.5925746882649037e-8,1.7953350095467613e-7,0.22928662598133087,0.9733589291572571] },
	{"name":"toe_a1.L","len":0.1,"idx":26,"p_idx":25, "pos":[0,0.0928,0],"rot":[-4.057931235479373e-8,-1.8153022551814502e-7,-1.1981786940395978e-7,1]},
	{"name":"toe_b0.L","len":0.1053,"idx":27,"p_idx":24,"pos":[0,0.1677,0],"rot":[-1.5791218999083867e-8,5.908116236241767e-7,-1.0553894997517022e-14,1] },
	{"name":"toe_b1.L","len":0.1,"idx":28,"p_idx":27,"pos":[0,0.1053,0],"rot":[-4.531181474476398e-8,-4.722371045318141e-7,-3.565666506629914e-14,1]},
	{"name":"toe_c0.L","len":0.0921,"idx":29,"p_idx":24,"pos":[0.0699,0.1537,0],"rot":[2.3490257206049137e-7,7.702470270487538e-7,-0.23078592121601105,0.9730045795440674] },
	{"name":"toe_c1.L","len":0.1,"idx":30,"p_idx":29,"pos":[0,0.0921,0],"rot":[-1.7926815359860931e-13,-9.430226555195986e-7,2.266179279786229e-7,1] },
	
	{"name":"tail0","len":0.3950,"idx":31,"p_idx":0,"pos":[0,-0.3295,0.0868],"rot":[0.000043130767153343186,0.019211696460843086,0.9998154640197754,-0.000041207309550372884]},
	{"name":"tail1","len":0.4390,"idx":32,"p_idx":31,"pos":[0,0.3950,0],"rot":[-3.0723953159395023e-7,0.00004249659104971215,-0.000042428400774952024,1]},
	{"name":"tail2","len":0.4516,"idx":33,"p_idx":32,"pos":[0,0.4390,0],"rot":[-3.275013249416821e-14,9.539368406308313e-9,6.021979789827547e-13,1]},
	{"name":"tail3","len":0.3606,"idx":34,"p_idx":33,"pos":[0,0.4516,0],"rot":[1.6525058299521334e-7,1.845068802602823e-12,1.0934796904754629e-13,1]},
	{"name":"tail4","len":0.3126,"idx":35,"p_idx":34, "pos":[0,0.3606,0],"rot":[-3.558520518254227e-7,-3.145555952483673e-15,-2.35280165575974e-13,1]},
	{"name":"tail5","len":0.2065,"idx":36,"p_idx":35,"pos":[0,0.3126,0],"rot":[1.906014261976452e-7,1.1920926823449918e-7,1.4883890832057683e-13,1]},
	{"name":"tail6","len":0.1,"idx":37,"p_idx":36, "top":[0.05,0.1], "bot":[0.1,0], "pos":[0,0.2065,0],"rot":[6.884149317493236e-15,-1.1918253051135252e-7,2.782902263657872e-17,1]},

	{"name":"leg_0.R","len":0.6824,"idx":38,"p_idx":0,"pos":[0.3682,-0.0019,0],"rot":[-0.7205613851547241, 5.32519550233701e-7, -4.926509404867829e-7, 0.6933911442756653]},
	{"name":"leg_1.R","len":0.5962,"idx":39,"p_idx":38,"pos":[0,0.6824,0],"rot":[-1.3867997801010092e-14, -2.0126897481986816e-7, -4.5259392886026414e-15, 1]},
	{"name":"leg_2.R","len":0.4033,"idx":40,"p_idx":39,"pos":[0,0.5962,0],"rot":[-2.6553610903461636e-22, 5.373501608119113e-7, -8.770604769167695e-23, 1]},
	
	{"name":"foot.R","len":0.1590,"idx":41,"p_idx":40,"pos":[0,0.4033,0],"rot":[0.6393924951553345,-2.787829487260751e-7,2.8139376695435203e-7,0.7688804864883423] },
	{"name":"toe_a0.R","len":0.0928,"idx":42,"p_idx":41,"pos":[0.0717,0.1534,0],"rot":[5.872381336757826e-8,-5.923289947418198e-8,-0.2292865812778473,0.9733589887619019]},
	{"name":"toe_a1.R","len":0.1,"idx":43,"p_idx":42, "pos":[0,0.0928,0],"rot":[-4.057930880208005e-8,4.419701227220685e-8,1.199775567783945e-7,1]},
	{"name":"toe_b0.R","len":0.1053,"idx":44,"p_idx":41, "pos":[0,0.1677,0],"rot":[6.5607981269977245e-9,-6.273558028624393e-7,-3.607205425879738e-15,1] },
	{"name":"toe_b1.R","len":0.1,"idx":45,"p_idx":44,"pos":[0,0.1053,0],"rot":[-4.531177921762719e-8,5.318430567058385e-7,2.924194225520718e-14,1]},
	{"name":"toe_c0.R","len":0.0921,"idx":46,"p_idx":41,"pos":[-0.0699,0.1537,0],"rot":[2.8437952437343483e-7,-0.0000010440704727443517,0.23078593611717224,0.9730045795440674]},
	{"name":"toe_c1.R","len":0.1,"idx":47,"p_idx":46,"pos":[0,0.0921,0],"rot":[-2.697945491146603e-13,0.0000010533635759202298,-2.5324561647721566e-7,1] }
];

const DINO_CONFIG = [
	{"name":"hips", "top":[0.8,0.8,0.9,0], "bot":[0.8,0.8,0.9,0], "pos":[0,0,-0.05] },
	{"name":"spine1", "top":[0.7,0.8,0.8,0.17], "bot":[0.7,0.5,0.8,0.03], "pos":[0,0,0] },
	{"name":"spine2", "top":[0.6,0.24], "bot":[0.6,0.6,0.65,0.02], "pos":[0,0,0.06] },
	{"name":"neck","top":[0.38,0.25], "bot":[0.42,0], "pos":[0,0,0.10] },
	{"name":"head","top":[0.58,0.4], "bot":[0.65,0.65,0.65,0], "pos":[0,0,0.08] },
	
	{"name":"shoulder.L","top":[0.2,0.13], "bot":[0.1,0] },
	{"name":"arm_up.L","top":[0.1,0.19], "bot":[0.14,0] },
	{"name":"arm_fore.L","top":[0.07,0.2], "bot":[0.1,0.02] },
	{"name":"hand.L","top":[0.19,0.1,0.1,0.09], "bot":[0.14,0.1,0.1,0] },
	
	{"name":"finger_a0.L","top":[0.07,0.05], "bot":[0.07,0] },
	{"name":"finger_a1.L","top":[0.04,0.08], "bot":[0.07,0.01] },
	{"name":"finger_b0.L","top":[0.07,0.05], "bot":[0.07,0] },
	{"name":"finger_b1.L","top":[0.04,0.08], "bot":[0.07,0.01] },
	
	{"name":"shoulder.R","top":[0.2,0.13], "bot":[0.1,0] },
	{"name":"arm_up.R","top":[0.1,0.19], "bot":[0.14,0] },
	{"name":"arm_fore.R","top":[0.07,0.2], "bot":[0.1,0.02] },
	{"name":"hand.R","top":[0.19,0.1,0.1,0.09], "bot":[0.14,0.1,0.1,0] },
	
	{"name":"finger_a0.R","top":[0.07,0.05], "bot":[0.07,0] },
	{"name":"finger_a1.R","top":[0.04,0.08], "bot":[0.07,0.01] },
	{"name":"finger_b0.R","top":[0.07,0.05], "bot":[0.07,0] },
	{"name":"finger_b1.R","top":[0.04,0.08], "bot":[0.07,0.01] },
	
	{"name":"leg_0.L","top":[0.4,0.55], "bot":[0.53,0.11] },
	{"name":"leg_1.L","top":[0.28,0.5], "bot":[0.37,0.05] },
	{"name":"leg_2.L","top":[0.18,0.3], "bot":[0.18,0] },
	
	{"name":"foot.L","top":[0.2,0.1,0.1,0.09], "bot":[0.18,0.1,0.1,-0.02] },
	{"name":"toe_a0.L","top":[0.1,0.04], "bot":[0.1,0] },
	{"name":"toe_a1.L","top":[0.06,0.07], "bot":[0.09,0.01] },
	{"name":"toe_b0.L","top":[0.1,0.04], "bot":[0.1,0] },
	{"name":"toe_b1.L","top":[0.06,0.07], "bot":[0.09,0.01] },
	{"name":"toe_c0.L","top":[0.1,0.04], "bot":[0.1,0] },
	{"name":"toe_c1.L","top":[0.06,0.07], "bot":[0.09,0.01] },
	
	{"name":"tail0","top":[0.45,0.25], "bot":[0.49,0] },
	{"name":"tail1","top":[0.38,0.27], "bot":[0.40,0] },
	{"name":"tail2","top":[0.30,0.32], "bot":[0.32,0] },
	{"name":"tail3","top":[0.23,0.26], "bot":[0.25,0] },
	{"name":"tail4","top":[0.16,0.25], "bot":[0.18,0] },
	{"name":"tail5","top":[0.11,0.16], "bot":[0.13,0] },
	{"name":"tail6","top":[0.05,0.1], "bot":[0.1,0] },
	
	{"name":"leg_0.R","top":[0.4,0.55], "bot":[0.53,0.11] },
	{"name":"leg_1.R","top":[0.28,0.5], "bot":[0.37,0.05] },
	{"name":"leg_2.R", "top":[0.18,0.3], "bot":[0.18,0] },
	{"name":"foot.R","top":[0.2,0.1,0.1,0.09], "bot":[0.18,0.1,0.1,-0.02] },
	{"name":"toe_a0.R","top":[0.1,0.04], "bot":[0.1,0] },
	{"name":"toe_a1.R","top":[0.06,0.07], "bot":[0.09,0.01] },
	{"name":"toe_b0.R","top":[0.1,0.04], "bot":[0.1,0] },
	{"name":"toe_b1.R","top":[0.06,0.07], "bot":[0.09,0.01] },
	{"name":"toe_c0.R","top":[0.1,0.04], "bot":[0.1,0] },
	{"name":"toe_c1.R","top":[0.06,0.07], "bot":[0.09,0.01] },
];

function ProtoDino( name="ProtoDino", inc_eye=false, use_preview=false ){
	let e = App.mesh_entity( name );

	//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
	// CREATE ARMATURE
	let arm = App.ecs.add_com( e.id, "Armature" );
	arm
		.load_config( DINO_BONES )
		.anchor_root_bones( e.node );
	
	//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
	// BONE PREVIEW
	if( use_preview ){
		let bview = App.ecs.add_com( e.id, "BoneView" );
		let mat = App.shader.new_material( "BoneView" ).set_depth_test( true );
		bview.use_armature( arm );
		e.draw.add( bview.mesh, mat, App.mesh.LINE );
	}

	//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
	// PROTOFORM
	let pro = App.ecs.add_com( e.id, "ProtoForm" );
	pro.use_armature( arm, DINO_CONFIG );
	e.draw.items.push( pro.get_draw_item() );

	//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
	// EYEBALL
	if( inc_eye ){
		let eye_l = EyeBall();
		let eye_r = EyeBall();

		eye_l.node.set_pos( -0.28, 0.0, 0.15 ).set_scl( 0.2 ).rot_by( -90, "y" ).rot_by( -20, "x" );
		eye_r.node.set_pos( 0.28, 0.0, 0.15 ).set_scl( 0.2 ).rot_by( 90, "y" ).rot_by( -20, "x" );
		
		arm.attach_to_bone( "head", eye_l.node );
		arm.attach_to_bone( "head", eye_r.node );
		
		e.eye_l = eye_l;
		e.eye_r = eye_r;
	}

	//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
	e.proto	= pro;
	e.arm	= arm;
	return e;
}

export default ProtoDino;