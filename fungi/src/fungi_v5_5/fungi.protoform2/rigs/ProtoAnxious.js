import App		from "../../fungi/App.js";
import EyeBall	from "./EyeBall.js";

const BONES = [
	{"name":"hip","len":0.04887452721595764,"idx":0,"p_idx":null,"pos":[0,0.3813585042953491,4.952967103122319e-8],"rot":[0,1.1920928955078125e-7,0,1]},
	{"name":"spine.0","len":0.1,"idx":1,"p_idx":0,"pos":[0,0.04887452721595764,0],"rot":[0,-1.1920928955078125e-7,0,1]},
	{"name":"spine.1","len":0.1,"idx":2,"p_idx":1,"pos":[0,0.1,0],"rot":[0,1.1920928955078125e-7,0,1]},
	{"name":"spine.2","len":0.16781854629516602,"idx":3,"p_idx":2,"pos":[0,0.1,0],"rot":[0,0,0,1]},
	{"name":"neck","len":0.0389065146446228,"idx":4,"p_idx":3,"pos":[0,0.16781854629516602,0],"rot":[0,-7.105427357601002e-15,0,1]},
	{"name":"head","len":0.38133754220468075,"idx":5,"p_idx":4,"pos":[0,0.0389065146446228,0],"rot":[0,0,0,1]},
	{"name":"ear.l","len":0.1,"idx":6,"p_idx":5,"pos":[0.15305176377296448,0.3492756485939026,3.0903908765367305e-8],"rot":[7.079385255792658e-8,-1.8000210388890991e-7,-0.34201863408088684,0.9396932721138]},
	{"name":"ear.r","len":0.1,"idx":7,"p_idx":5,"pos":[-0.15305176377296448,0.3492756485939026,-4.2076855777395394e-8],"rot":[-1.0749737100468337e-8,-4.4038262814183327e-8,0.34201863408088684,0.9396932721138]},
	{"name":"arm.l.0","len":0.20677294138763766,"idx":8,"p_idx":3,"pos":[0.07022689282894135,0.09946686029434204,0.006240016780793667],"rot":[0.7074113488197327,0.7067425847053528,-0.006487236358225346,0.006481272634118795]},
	{"name":"arm.l.1","len":0.20677298626024662,"idx":9,"p_idx":8,"pos":[3.710010787472129e-8,0.20677293837070465,-3.069544618483633e-10],"rot":[2.7921585044055064e-9,-3.7718598377978196e-7,1.442390100692137e-7,1]},
	{"name":"hand.l","len":0.07,"idx":10,"p_idx":9,"pos":[-3.9872247725725174e-8,0.20677296817302704,1.3706085155718029e-9],"rot":[-0.000008677317055116873,-0.00000362331093128887,-0.00047295738477259874,0.9999998807907104]},
	
	{"name":"fingerb.l.0","len":0.050478659740242696,"idx":11,"p_idx":10,"pos":[0.0004743118479382247,0.070,0.025846650823950768],"rot":[0.00000866924619913334,0.00000458117619928089,0.0004722355224657804,0.9999998807907104]},
	{"name":"fingerb.l.1","len":0.1,"idx":12,"p_idx":11,"pos":[1.4028046280145645e-8,0.05047868564724922,-4.083631210960448e-10],"rot":[1.604252020115382e-8,-0.0000011799836556747323,0.00000118129059956118,1]},
	
	{"name":"fingera.l.0","len":0.050478659683973616,"idx":13,"p_idx":10,"pos":[-0.0005314966547302902,0.070,-0.028964124619960785],"rot":[0.00000866924619913334,0.00000458117619928089,0.0004722355224657804,0.9999998807907104]},
	{"name":"fingera.l.1","len":0.1,"idx":14,"p_idx":13,"pos":[5.925539880990982e-8,0.05047868564724922,2.3856046027503908e-9],"rot":[1.604252020115382e-8,-0.0000011799836556747323,0.00000118129059956118,1]},
	
	{"name":"thumb.l.0","len":0.037352771124575704,"idx":15,"p_idx":10,"pos":[-0.0011739166220650077,0.056101396679878235,-0.06397233158349991],"rot":[0.000011663744771794882,0.000007769095645926427,0.0006381805869750679,0.9999998807907104]},
	{"name":"thumb.l.1","len":0.1,"idx":16,"p_idx":15,"pos":[5.1048118621110916e-8,0.03735276684165001,1.4851138985250145e-8],"rot":[7.152227965434577e-8,-0.0000017164561540994328,0.0000015956393326632679,1]},
	{"name":"arm.r.0","len":0.20677294138763766,"idx":17,"p_idx":3,"pos":[-0.07022689282894135,0.09946686029434204,0.006239983253180981],"rot":[0.7074113488197327,-0.7067425847053528,0.006487404927611351,0.00648110406473279]},
	{"name":"arm.r.1","len":0.20677298626024662,"idx":18,"p_idx":17,"pos":[-3.712921170517802e-8,0.20677293837070465,-4.706635081674904e-10],"rot":[2.4975443935204567e-9,3.771858132495254e-7,-1.4416897897717718e-7,1]},
	{"name":"hand.r","len":0.0658744817057813,"idx":19,"p_idx":18,"pos":[3.9872247725725174e-8,0.20677296817302704,1.36969902087003e-9],"rot":[-0.000008677317055116873,0.00000362331093128887,0.00047295738477259874,0.9999998807907104]},
	{"name":"fingerb.r.0","len":0.050478659740242696,"idx":20,"p_idx":19,"pos":[-0.0004743118479382247,0.0605902224779129,0.025846650823950768],"rot":[0.00000866924619913334,-0.00000458117619928089,-0.0004722355224657804,0.9999998807907104]},
	{"name":"fingerb.r.1","len":0.1,"idx":21,"p_idx":20,"pos":[-1.4028046280145645e-8,0.05047868564724922,-4.083631210960448e-10],"rot":[1.604252020115382e-8,0.0000011799836556747323,-0.00000118129059956118,1]},
	{"name":"fingera.r.0","len":0.050478659683973616,"idx":22,"p_idx":19,"pos":[0.0005314966547302902,0.0605902224779129,-0.028964124619960785],"rot":[0.00000866924619913334,-0.00000458117619928089,-0.0004722355224657804,0.9999998807907104]},
	{"name":"fingera.r.1","len":0.1,"idx":23,"p_idx":22,"pos":[-5.925539880990982e-8,0.05047868564724922,2.3856046027503908e-9],"rot":[1.604252020115382e-8,0.0000011799836556747323,-0.00000118129059956118,1]},
	{"name":"thumb.r.0","len":0.037352771124575704,"idx":24,"p_idx":19,"pos":[0.0011739166220650077,0.056101396679878235,-0.06397233158349991],"rot":[0.000011663744771794882,-0.000007769095645926427,-0.0006381805869750679,0.9999998807907104]},
	{"name":"thumb.r.1","len":0.1,"idx":25,"p_idx":24,"pos":[-5.1048118621110916e-8,0.03735276684165001,1.4851138985250145e-8],"rot":[7.152227965434577e-8,0.0000017164561540994328,-0.0000015956393326632679,1]},
	{"name":"leg.l.0","len":0.20113365352153778,"idx":26,"p_idx":0,"pos":[0.060,0.000694960355758667,1.7893061254881104e-8],"rot":[-1.6292068494294654e-7,0,1,0]},
	{"name":"leg.l.1","len":0.18,"idx":27,"p_idx":26,"pos":[-4.3298697960381105e-15,0.20113365352153778,4.440892098500626e-16],"rot":[0,-7.105427357601002e-15,0,1]},
	{"name":"leg.r.0","len":0.20113365352153778,"idx":28,"p_idx":0,"pos":[-0.060,0.000694960355758667,-1.7893061254881104e-8],"rot":[-7.549790126404332e-8,0,1,0]},
	{"name":"leg.r.1","len":0.18,"idx":29,"p_idx":28,"pos":[4.3298697960381105e-15,0.20113365352153778,-1.7763568394002505e-15],"rot":[0,0,0,1]},
	
	{"name":"tail.0","len":0.08,"idx":30,"p_idx":0,"pos":[0,0.02,-0.035],"rot":[-0.7071068286895752,0,-1.685874053691805e-7,0.7071068286895752]},
	{"name":"tail.1","len":0.08,"idx":31,"p_idx":30,"pos":[0,0.08,0],"rot":[0,0,0,1]},
	{"name":"tail.2","len":0.08,"idx":32,"p_idx":31,"pos":[0,0.08,0],"rot":[0,0,0,1]},
	{"name":"tail.3","len":0.08,"idx":33,"p_idx":32,"pos":[0,0.08,0],"rot":[0,0,0,1]},
	{"name":"tail.4","len":0.08,"idx":34,"p_idx":33,"pos":[0,0.08,0],"rot":[0,0,0,1]},
	{"name":"tail.5","len":0.08,"idx":35,"p_idx":34,"pos":[0,0.08,0],"rot":[0,0,0,1]},
];

const CONFIG = [
	{"bone":"hip", "base_opt":[1,0,1], "scl_top":[0.035,0.02,0.04], "scl_mid":[0.02,0,0.03], "scl_bot":[0.035,0.02,0.04], "pos_top":[0,0.04,0], "pos_mid":[0,0,0], "pos_bot":[0,-0.04,0], "base_pos":[0,0.023,0], "base_rot":[0,0,0.707106769084934,0.707106769084934]},
	{"bone":"spine.0", "base_opt":[1,0,1], "scl_top":[0.02,0.02,0.02], "scl_mid":[0.018,0,0.018], "scl_bot":[0.02,0.015,0.02], "pos_top":[0,0.07,0], "pos_mid":[0,0,0], "pos_bot":[0,-0.01,0], "base_pos":[0,0.016,0], "base_rot":[0,0,0,1]},
	{"bone":"spine.1", "base_opt":[1,0.3000,0.52], "scl_top":[0.02,0.02,0.02], "scl_mid":[0.017,0,0.017], "scl_bot":[0.02,0.02,0.02], "pos_top":[0,0.055,0], "pos_mid":[0,0,0], "pos_bot":[0,-0.02,0], "base_pos":[0,0.033,0], "base_rot":[0,0,0,1]},

	{"bone":"head", "base_opt":[0,0,1], "scl_top":[0.23,0.2000,0.23], "scl_mid":[1,1,1], "scl_bot":[0.23,0.2000,0.23], "pos_top":[0,0.01,0], "pos_mid":[0,0,0], "pos_bot":[0,0,0], "base_pos":[0,0.19,0], "base_rot":[0,0,0,1]},
	{"bone":"neck", "base_opt":[1,0.5000,0], "scl_top":[0.1000,0.03,0.1000], "scl_mid":[0.105,0,0.105], "scl_bot":[0.1000,0.03,0.1000], "pos_top":[0,0.02,0], "pos_mid":[0,0,0], "pos_bot":[0,-0.02,0], "base_pos":[0,0,0], "base_rot":[0,0,0,1]},
	{"bone":"spine.2", "base_opt":[1,-0.34,0.36], "scl_top":[0.07,0.04,0.07], "scl_mid":[0.054,0,0.07], "scl_bot":[0.07,0.04,0.07], "pos_top":[0.01,0.04,0], "pos_mid":[0.02,0,0], "pos_bot":[0.01,-0.04,0], "base_pos":[0,0.05,0], "base_rot":[0,0,0.707106769084934,0.707106769084934]},
	
	{"bone":"arm.l.0", "base_opt":[0,0,1], "scl_top":[0.03,0.03,0.03], "scl_mid":[1,1,1], "scl_bot":[0.02,0.02,0.02], "pos_top":[0,0.18,0], "pos_mid":[0,0,0], "pos_bot":[0,0.02,0], "base_pos":[0,0.02,0], "base_rot":[0,0,0,1]},
	{"bone":"arm.l.1", "base_opt":[0,0,1], "scl_top":[0.035,0.01,0.035], "scl_mid":[1,1,1], "scl_bot":[0.03,0.03,0.03], "pos_top":[0,0.17,0], "pos_mid":[0,0,0], "pos_bot":[0,0.03,0], "base_pos":[0,0.03,0], "base_rot":[0,0,0,1]},
	{"bone":"hand.l", "base_opt":[0,0,1], "scl_top":[0.0354,0.02,0.06], "scl_mid":[1,1,1], "scl_bot":[0.04,0.03,0.05], "pos_top":[0,0.02,0], "pos_mid":[0,0,0], "pos_bot":[0,0.03,0], "base_pos":[0,0.04,0], "base_rot":[0,0,0,1]},

	{"bone":"arm.r.0", "base_opt":[0,0,1], "scl_top":[0.03,0.03,0.03], "scl_mid":[1,1,1], "scl_bot":[0.02,0.02,0.02], "pos_top":[0,0.18,0], "pos_mid":[0,0,0], "pos_bot":[0,0.02,0], "base_pos":[0,0.02,0], "base_rot":[0,0,0,1]},
	{"bone":"arm.r.1", "base_opt":[0,0,1], "scl_top":[0.035,0.01,0.035], "scl_mid":[1,1,1], "scl_bot":[0.03,0.03,0.03], "pos_top":[0,0.17,0], "pos_mid":[0,0,0], "pos_bot":[0,0.03,0], "base_pos":[0,0.03,0], "base_rot":[0,0,0,1]},
	{"bone":"hand.r", "base_opt":[0,0,1], "scl_top":[0.0354,0.02,0.06], "scl_mid":[1,1,1], "scl_bot":[0.04,0.03,0.05], "pos_top":[0,0.02,0], "pos_mid":[0,0,0], "pos_bot":[0,0.03,0], "base_pos":[0,0.04,0], "base_rot":[0,0,0,1]},

	{"bone":"fingera.l.0", "base_opt":[0,0,1], "scl_top":[0.02,0.015,0.02], "scl_mid":[1,1,1], "scl_bot":[0.02,0.025,0.02], "pos_top":[0,0.015,0], "pos_mid":[0,0,0], "pos_bot":[0,0.016,0], "base_pos":[0,0.03,0], "base_rot":[0,0,0,1]},
	{"bone":"fingera.l.1", "base_opt":[0,0,1], "scl_top":[0.02,0.02,0.02], "scl_mid":[1,1,1], "scl_bot":[0.02,0.015,0.02], "pos_top":[0,0.015,0], "pos_mid":[0,0,0], "pos_bot":[0,0.01,0], "base_pos":[0,0.015,0], "base_rot":[0,0,0,1]},

	{"bone":"fingerb.l.0", "base_opt":[0,0,1], "scl_top":[0.02,0.015,0.03], "scl_mid":[1,1,1], "scl_bot":[0.02,0.03,0.03], "pos_top":[0,0.015,0], "pos_mid":[0,0,0], "pos_bot":[0,0.016,0], "base_pos":[0,0.03,0], "base_rot":[0,0,0,1]},
	{"bone":"fingerb.l.1", "base_opt":[0,0,1], "scl_top":[0.02,0.02,0.03], "scl_mid":[1,1,1], "scl_bot":[0.02,0.015,0.03], "pos_top":[0,0.015,0], "pos_mid":[0,0,0], "pos_bot":[0,0.01,0], "base_pos":[0,0.015,0], "base_rot":[0,0,0,1]},

	{"bone":"thumb.l.1", "base_opt":[0,0,1], "scl_top":[0.02,0.02,0.017], "scl_mid":[1,1,1], "scl_bot":[0.02,0.02,0.02], "pos_top":[0,0.01,0], "pos_mid":[0,0,0], "pos_bot":[0,0.01,0], "base_pos":[0,0.02,0], "base_rot":[0,0,0,1]},
	{"bone":"thumb.l.0", "base_opt":[0,0,1], "scl_top":[0.02,0.02,0.02], "scl_mid":[1,1,1], "scl_bot":[0.02,0.02,0.02], "pos_top":[0,0.01,0], "pos_mid":[0,0,0], "pos_bot":[0,0.01,0], "base_pos":[0,0.02,0], "base_rot":[0,0,0,1]},

	{"bone":"fingera.r.0", "base_opt":[0,0,1], "scl_top":[0.02,0.015,0.02], "scl_mid":[1,1,1], "scl_bot":[0.02,0.025,0.02], "pos_top":[0,0.015,0], "pos_mid":[0,0,0], "pos_bot":[0,0.016,0], "base_pos":[0,0.03,0], "base_rot":[0,0,0,1]},
	{"bone":"fingera.r.1", "base_opt":[0,0,1], "scl_top":[0.02,0.02,0.02], "scl_mid":[1,1,1], "scl_bot":[0.02,0.015,0.02], "pos_top":[0,0.015,0], "pos_mid":[0,0,0], "pos_bot":[0,0.01,0], "base_pos":[0,0.015,0], "base_rot":[0,0,0,1]},

	{"bone":"fingerb.r.0", "base_opt":[0,0,1], "scl_top":[0.02,0.015,0.03], "scl_mid":[1,1,1], "scl_bot":[0.02,0.03,0.03], "pos_top":[0,0.015,0], "pos_mid":[0,0,0], "pos_bot":[0,0.016,0], "base_pos":[0,0.03,0], "base_rot":[0,0,0,1]},
	{"bone":"fingerb.r.1", "base_opt":[0,0,1], "scl_top":[0.02,0.02,0.03], "scl_mid":[1,1,1], "scl_bot":[0.02,0.015,0.03], "pos_top":[0,0.015,0], "pos_mid":[0,0,0], "pos_bot":[0,0.01,0], "base_pos":[0,0.015,0], "base_rot":[0,0,0,1]},

	{"bone":"thumb.r.1", "base_opt":[0,0,1], "scl_top":[0.02,0.02,0.017], "scl_mid":[1,1,1], "scl_bot":[0.02,0.02,0.02], "pos_top":[0,0.01,0], "pos_mid":[0,0,0], "pos_bot":[0,0.01,0], "base_pos":[0,0.02,0], "base_rot":[0,0,0,1]},
	{"bone":"thumb.r.0", "base_opt":[0,0,1], "scl_top":[0.02,0.02,0.02], "scl_mid":[1,1,1], "scl_bot":[0.02,0.02,0.02], "pos_top":[0,0.01,0], "pos_mid":[0,0,0], "pos_bot":[0,0.01,0], "base_pos":[0,0.02,0], "base_rot":[0,0,0,1]},

	{"bone":"ear.l", "base_opt":[3.0000,0,0.8000], "scl_top":[0.007,0.02,0.01], "scl_mid":[0.02,0,0.02], "scl_bot":[0.05,0.01,0.03], "pos_top":[0,0.05,0], "pos_mid":[0,0,0], "pos_bot":[0,-0.06,0], "base_pos":[0,0.04,0], "base_rot":[0,0,0,1]},
	{"bone":"ear.r", "base_opt":[3.0000,0,0.8000], "scl_top":[0.007,0.02,0.01], "scl_mid":[0.02,0,0.02], "scl_bot":[0.05,0.01,0.03], "pos_top":[0,0.05,0], "pos_mid":[0,0,0], "pos_bot":[0,-0.06,0], "base_pos":[0,0.04,0], "base_rot":[0,0,0,1]},

	{"bone":"leg.l.0", "base_opt":[1,0.13,0.38], "scl_top":[0.02,0.02,0.02], "scl_mid":[0.02,0,0.02], "scl_bot":[0.05,0.08,0.05], "pos_top":[0,0.12,0], "pos_mid":[0.005,0,0], "pos_bot":[0,-0.07,0], "base_pos":[0,0.07,0], "base_rot":[0,0,0,1]},
	{"bone":"leg.l.1", "base_opt":[1,0,1], "scl_top":[0.02,0.005,0.016], "scl_mid":[0.02,0,0.02], "scl_bot":[0.027,0.02,0.02], "pos_top":[0,0.158,0], "pos_mid":[-0.005,0.04,0], "pos_bot":[0,-0.02,0], "base_pos":[0,0.02,0], "base_rot":[0,0,0,1]},

	{"bone":"leg.r.0", "base_opt":[1,0.13,0.38], "scl_top":[0.02,0.02,0.02], "scl_mid":[0.02,0,0.02], "scl_bot":[0.05,0.08,0.05], "pos_top":[0,0.12,0], "pos_mid":[-0.005,0,0], "pos_bot":[0,-0.07,0], "base_pos":[0,0.07,0], "base_rot":[0,0,0,1]},
	{"bone":"leg.r.1", "base_opt":[1,0,1], "scl_top":[0.02,0.005,0.016], "scl_mid":[0.02,0,0.02], "scl_bot":[0.027,0.02,0.02], "pos_top":[0,0.158,0], "pos_mid":[0.005,0.04,0], "pos_bot":[0,-0.02,0], "base_pos":[0,0.02,0], "base_rot":[0,0,0,1]},

	{"bone":"tail.0", "base_opt":[1,0,1], "scl_top":[0.02,0.02,0.02], "scl_mid":[0.018,0,0.018], "scl_bot":[0.02,0.02,0.02], "pos_top":[0,0.04,0], "pos_mid":[0,0,0], "pos_bot":[0,-0.02,0], "base_pos":[0,0.03,0], "base_rot":[0,0,0,1]},
	{"bone":"tail.1", "base_opt":[1,0,1], "scl_top":[0.02,0.02,0.02], "scl_mid":[0.018,0,0.018], "scl_bot":[0.02,0.02,0.02], "pos_top":[0,0.04,0], "pos_mid":[0,0,0], "pos_bot":[0,-0.02,0], "base_pos":[0,0.03,0], "base_rot":[0,0,0,1]},
	{"bone":"tail.2", "base_opt":[1,0,1], "scl_top":[0.02,0.02,0.02], "scl_mid":[0.018,0,0.018], "scl_bot":[0.02,0.02,0.02], "pos_top":[0,0.04,0], "pos_mid":[0,0,0], "pos_bot":[0,-0.02,0], "base_pos":[0,0.03,0], "base_rot":[0,0,0,1]},
	{"bone":"tail.3", "base_opt":[1,0,1], "scl_top":[0.02,0.02,0.02], "scl_mid":[0.018,0,0.018], "scl_bot":[0.02,0.02,0.02], "pos_top":[0,0.04,0], "pos_mid":[0,0,0], "pos_bot":[0,-0.02,0], "base_pos":[0,0.03,0], "base_rot":[0,0,0,1]},
	{"bone":"tail.4", "base_opt":[1,0,1], "scl_top":[0.02,0.02,0.02], "scl_mid":[0.018,0,0.018], "scl_bot":[0.02,0.02,0.02], "pos_top":[0,0.04,0], "pos_mid":[0,0,0], "pos_bot":[0,-0.02,0], "base_pos":[0,0.03,0], "base_rot":[0,0,0,1]},
	{"bone":"tail.5", "base_opt":[1,0,1], "scl_top":[0.02,0.02,0.02], "scl_mid":[0.018,0,0.018], "scl_bot":[0.02,0.02,0.02], "pos_top":[0,0.04,0], "pos_mid":[0,0,0], "pos_bot":[0,-0.02,0], "base_pos":[0,0.03,0], "base_rot":[0,0,0,1]},
];

function ProtoEntity( name="ProtoAnxious", inc_eye=false, use_preview=false ){
	let e = App.mesh_entity( name );

	//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
	// CREATE ARMATURE
	let arm = App.ecs.add_com( e.id, "Armature" );
	arm
		.load_config( BONES )
		.anchor_root_bones( e.node );

	//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
	// PROTOFORM
	let pro = App.ecs.add_com( e.id, "ProtoForm" );
	pro.use_armature( arm, CONFIG ); // pro.use_config( CONFIG );
	e.draw.add( pro.get_draw_item() );

	//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
	// BONE PREVIEW
	if( use_preview ){
		e.bview = App.ecs.add_com( e.id, "BoneView" );
		e.bview.use_armature( e.arm );
		e.draw.add( e.bview.get_draw_item() );
	}

	//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
	// EYEBALL
	if( inc_eye ){
		let eye = EyeBall();
		eye.node.set_scl( 0.3 ).set_pos( 0, 0.195, 0.13 );
		arm.attach_to_bone( "head", eye.node );
		e.eye = eye;
	}

	//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
	e.proto	= pro;
	e.arm	= arm;
	return e;
}

export default ProtoEntity;